"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[3777],{73777:(e,n,i)=>{i.d(n,{h:()=>D});var a=i(64467),l=i(5544),t=i(55364),d=i.n(t),r=i(95420),u=i(96540),s=i(95964),o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"NewsletterV3ViewerEdge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"username"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterSlug"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}}},{kind:"Argument",name:{kind:"Name",value:"collectionSlug"},value:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}}},{kind:"Argument",name:{kind:"Name",value:"username"},value:{kind:"Variable",name:{kind:"Name",value:"username"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewerEdge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3ViewerEdge"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isSubscribed"}}]}}]},m=i(27721),k=i(21335),v=i(34317),c=i(49287),N=i(91830),S={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_user"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},b={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"SubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}},{kind:"Argument",name:{kind:"Name",value:"shouldRecordConsent"},value:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}}}]}]}}]},w={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UnsubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unsubscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}}]}]}}]},g={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"FetchOrLazilyCreateNewsletterV3AndMaybeSubscribeMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},p=i(21800),V=i(80452),F=i(2550);function f(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function y(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?f(Object(i),!0).forEach((function(n){(0,a.A)(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}var D=function(e){var n=e.newsletterV3,i=e.creator,a=e.newsletterName,t=e.hideLinkInConfirmationToast,f=void 0!==t&&t,D=n||{},I=D.id,E=D.type,C=D.slug,O=D.collection,A=(null==n?void 0:n.user)||i,T=null!=a?a:null==n?void 0:n.name,_=(0,F.A)().viewerId,h=(0,k.cd)(null==A?void 0:A.id),U=h.viewerEdge,L=h.loading,P=(0,V.h)(),j=u.useState(!1),M=(0,l.A)(j,2),R=M[0],B=M[1],q=function(e){var n,i=e.newsletterSlug,a=void 0===i?"":i,l=e.collectionSlug,t=void 0===l?null:l,d=e.username,r=void 0===d?null:d,u=!!(0,m.R)().value,k=(0,s.IT)(o,{variables:{newsletterSlug:a,collectionSlug:t,username:r},ssr:!1,skip:!t&&!r||!a||!u}),v=k.loading,c=k.error,N=k.data;return v?{loading:v}:c?{error:c}:{viewerEdge:null==N||null===(n=N.newsletterV3)||void 0===n?void 0:n.viewerEdge}}({newsletterSlug:C,collectionSlug:null==O?void 0:O.slug,username:null==A?void 0:A.username}),z=q.viewerEdge,Q=q.loading,G=u.useState(!1),H=(0,l.A)(G,2),K=H[0],Y=H[1];u.useEffect((function(){Y(!(null==z||!z.isSubscribed))}),[null==z?void 0:z.isSubscribed]);var x=(0,v.$L)(),W=(0,c.jI)(),X=(0,N.zF)();R&&x.event("newsletterV3.subscribe.error",{newsletterV3Id:I});var $=function(e,n,i){if(i){var a={id:"User:".concat(null==A?void 0:A.id),fragment:S,fragmentName:"useNewsletterV3Subscription_user"},l=e.readFragment(a);l&&e.writeFragment(y(y({},a),{},{data:y(y({},l),{},{newsletterV3:i})}))}if(z){var t=e.readQuery({query:o,variables:{newsletterSlug:C||"",collectionSlug:(null==O?void 0:O.slug)||null,username:(null==A?void 0:A.username)||null}}),r=d()({},t,{newsletterV3:{viewerEdge:{isSubscribed:n}}});e.writeQuery({query:o,variables:{newsletterSlug:C||"",collectionSlug:(null==O?void 0:O.slug)||null,username:(null==A?void 0:A.username)||null},data:r})}if(n&&null!=A&&A.id&&(null==U||!U.isFollowing)){var u=A.id;(0,p.M)({cache:e,userId:u,viewerId:_}),(0,k.YG)(e,u,{isFollowing:!0})}},J=(0,u.useCallback)((function(e){x.event("newsletterV3.subscribeClicked",{newsletterV3Id:e,source:W}),null!=U&&U.isFollowing||null==A||!A.id||P("user.followed",{targetUserId:A.id})}),[W,x,null==U?void 0:U.isFollowing,null==A?void 0:A.id,P]),Z=(0,u.useCallback)((function(e){return function(n){var i=n.subscribeNewsletterV3;B(!i),i&&(J(I),e&&e(),Y(!0))}}),[W,I,J]),ee=(0,r.n)(b,{optimisticResponse:{subscribeNewsletterV3:!0},update:function(e){$(e,!0)}}),ne=(0,l.A)(ee,1)[0],ie=(0,u.useCallback)((function(e){return function(n){var i=n.unsubscribeNewsletterV3;B(!i),i&&(x.event("newsletterV3.unsubscribeClicked",{newsletterV3Id:I,source:W}),Y(!1),e?e():X({duration:f?5e3:"NEXTPAGE",toastStyle:"NEWSLETTER_UNSUBSCRIBE",extraParams:{newsletterName:T||null,newsletterType:E||null,unsubscribeFn:function(){return Y(!1)},hideEmailSettingsLink:f,hideCloseButton:f}}))}}),[W,I,f,T,E]),ae=(0,r.n)(w,{optimisticResponse:{unsubscribeNewsletterV3:!0},update:function(e){$(e,!1)}}),le=(0,l.A)(ae,1)[0],te=(0,u.useCallback)((function(e){return function(n){var i=n.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe;B(!i),i&&(J(i.id),e&&e(),Y(!0))}}),[W,J]),de=(0,r.n)(g,{update:function(e,n){var i,a=y({},null===(i=n.data)||void 0===i?void 0:i.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe);$(e,!0,a)}}),re=(0,l.A)(de,1)[0];return{isSubscribed:K,hasError:R,setSubscribe:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;B(!1),e&&!n&&null!=i&&i.id?re({variables:{userId:null==i?void 0:i.id},onCompleted:te(l)}):e&&null!=n&&n.id?ne({variables:{newsletterV3Id:null==n?void 0:n.id,shouldRecordConsent:a},onCompleted:Z(l)}):null!=n&&n.id?le({variables:{newsletterV3Id:null==n?void 0:n.id},onCompleted:ie(l)}):B(!0)},loading:Q||L}}},21335:(e,n,i)=>{i.d(n,{sf:()=>s,YG:()=>r,cd:()=>u});var a=i(55364),l=i.n(a),t=i(95964),d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"UserViewerEdge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewerEdge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"User_viewerEdge"}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"User_viewerEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserViewerEdge"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}},{kind:"Field",name:{kind:"Name",value:"hasCompletedProfile"}},{kind:"Field",name:{kind:"Name",value:"isAllowEdsEnabled"}},{kind:"Field",name:{kind:"Name",value:"isBlocking"}},{kind:"Field",name:{kind:"Name",value:"isFollowing"}},{kind:"Field",name:{kind:"Name",value:"isMuting"}},{kind:"Field",name:{kind:"Name",value:"isFacebookFollowing"}},{kind:"Field",name:{kind:"Name",value:"isMediumFollowing"}},{kind:"Field",name:{kind:"Name",value:"isSuperFollowing"}},{kind:"Field",name:{kind:"Name",value:"isTwitterFollowing"}},{kind:"Field",name:{kind:"Name",value:"isUser"}},{kind:"Field",name:{kind:"Name",value:"lastPostCreatedAt"}},{kind:"Field",name:{kind:"Name",value:"readPostsCount"}}]}}]};function r(e,n,i){var a=e.readQuery({query:d,variables:{userId:n}}),t=l()({},a,{user:{viewerEdge:i}});e.writeQuery({query:d,variables:{userId:n||""},data:t})}var u=function(e){var n,i=(0,t.IT)(d,{variables:{userId:null!=e?e:""},ssr:!1,skip:!e}),a=i.loading,l=i.error,r=i.data;return a?{loading:a}:l?{error:l}:{viewerEdge:null==r||null===(n=r.user)||void 0===n?void 0:n.viewerEdge}},s=function(e,n){var i=n.userId,a=n.viewerId;return e.identify({__typename:"UserViewerEdge",id:"userId:".concat(i,"-viewerId:").concat(a)})}}}]);
//# sourceMappingURL=https://stats.medium.build/lite/sourcemaps/3777.af05bea9.chunk.js.map